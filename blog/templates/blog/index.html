{% extends 'base.html' %}
{% load static %}

{% block css %}
<style>
/* Always set the map height explicitly to define the size of the div
 * element that contains the map. */
#map {
  height: 700px;
}
.sidebar-map {
  position: fixed;
  right: 0;
}
.content_list{
  margin-left: 15px;
}
#floating-panel {
  position: fixed;
  bottom: 20px;
  right: 60px;
  z-index: 5;
  background-color: #fff;
  padding: 1px;
/*  border: 1px solid #999;*/
  text-align: center;
  font-family: 'Roboto','sans-serif';
  line-height: 15px;
  padding: 3px;
}
</style>
{% endblock css %}

{% block main %}
  <div class="row"> 
      <div class="col-sm-{% if profile %}6{% else %}4{% endif %} content_list">
          <div id="post-container" class="photo">
            {% if profile %}
              {% include 'account/person_policy.html' with pList=True user=friend %}
            {% endif %}
            {% for post in post_list %}
              {% include 'blog/partial/post_detail.html' with pList=True %}
            {% endfor %}
          </div>
      </div>
      <div class="col-sm-{% if profile %}6{% else %}8{% endif %} sidebar-map">
          <div id="map" class="sidebar"></div>
      </div>
    {% if tag %}
      <div id="floating-panel">
        <input type=button value="food" class="tag" data-url="#">
      </div>
    {% else %}
      {% if pos %}
        <div id="floating-panel">
          <input type=button value="food" class="tag" data-url="{% url 'blog:cur_tag_list' 'food' %}"> 
          <input type=button value="tour" class="tag" data-url="{% url 'blog:cur_tag_list' 'tour' %}"> 
        </div>
      {% else %}
        <div id="floating-panel">
          <input type=button value="food" class="tag" data-url="{% url 'blog:tag_list' 'food' %}"> 
          <input type=button value="tour" class="tag" data-url="{% url 'blog:tag_list' 'tour' %}"> 
        </div>
      {% endif %}
      
    {% endif %}
  </div>
{% endblock main %}


{% block modal %}
<div class="modal fade" id="modal-theme">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close" type='button' data-dismiss='modal' aria-label='Close'>
                    <span aria-hidden='true'>&times;</span>
                </button>
                <h4 class="modal-title">Append My theme</h4>
            </div>
            <div class="modal-body">
                
            </div>
            <div class="modal-footer">
                <button type='button' class="btn btn-default" data-dismiss='modal'>Cancel</button>
                <button type='button' class="btn btn-primary js-crop-and-upload" data-dismiss='modal'>Crop and Upload</button>
            </div>
        </div>
    </div>
</div>
{% endblock modal %}


{% block javascript %}
{% include 'blog/gps.js' %}

{% if profile %}
<link href="{% static 'css/plugins/switchery/switchery.css' %}" rel="stylesheet">
<script src="{% static 'js/plugins/switchery/switchery.js' %}"></script>
<script>
{% for theme in friend.profile.get_theme_list %}
    var elem = document.querySelector('.js-switch1-{{forloop.counter}}');
    var init = new Switchery(elem, { color: '#ED5565' });
{% endfor %}

{% for theme in friend.profile.get_invited_theme %}
    var elem = document.querySelector('.js-switch2-{{forloop.counter}}');
    var init = new Switchery(elem, { color: '#ED5565' });
{% endfor %}
</script>
{% endif %}

<script>
function populateInfoWindow(marker, infoWindow) {
    if(infoWindow.marker != marker){
        infoWindow.marker = marker;
        $.ajax({
          type: 'GET',
          async: true,
          data: {'id': marker.id},
          url: "{% url 'blog:post_detail' %}",
          dataType: 'html',
          success: function(data){
            infoWindow.setContent(data);
          }
        });
        infoWindow.open(map, marker);

        infoWindow.addListener('closeclick',function() {
            infoWindow.setMarker(null);
        });
    }
}

</script>
<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
</script>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDXY6uFicQrbFZ-ddMHg2eQrFT9BAVqLOo&callback=initMap">
</script>

{% include 'blog/script.js' %}
<script>
$(function(){
    var loadForm = function(){
        var btn = $(this);
        $.ajax({
            url : btn.attr('data-url'),
            type : 'get',
            dataType : 'json',
            beforeSend: function(){
                $('#modal-theme').modal('show');
            },
            success: function(data) {
                $('#modal-theme .modal-content').html(data.html_form)
            }
        });
    }

    var saveForm = function(){
        var form = $(this);
        $.ajax({
            url: form.attr("action"),
            data : form.serialize(),
            type : form.attr('method'),
            dataType : 'json',
            beforeSend: function(){
                $('#modal-theme').modal('hide');
            },
            success : function(data) {
                console.log("Success");
            },
            complete: function(data){
                window.location.reload(true);
                console.log("Complete");
            },
        });
        return false;
    }

    $('.add-theme').click(loadForm);
    $('#modal-theme').on("submit", ".add-theme-form", saveForm);
    
    $(".theme_list").on("click", ".update-theme", loadForm);
    $("#modal-theme").on("submit", ".update-theme-form", saveForm);
})
</script>
{% endblock javascript %}